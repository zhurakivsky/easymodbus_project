<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">

    <title>Title</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
          integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
<div>
    <a th:href="'/'"><button>  На головну </button></a>
</div>
<div style="text-align: center">

    <h1 th:href="'/device/'+ ${device.id}" th:text="${device.name}" ></h1>
    <h2 th:href="'/device/'+ ${device.id}" th:text="'ipAddress = ' + ${device.ipAddress}" ></h2>
    <h2 th:href="'/device/'+ ${device.id}" th:text="'port = '+ ${device.port} " ></h2>
    <div id="editDevice" >
        <a th:href="'/device/del/'+ ${device.id}"><button>  Видалити </button></a>
        <button onclick="edit('rename')" >  Rename </button>
        <button onclick="edit('ip')" >  Change IP Address </button>
        <button onclick="edit('port')" >  Change Port  </button><br>
    </div>
</div>
<h3 >Стан підключення:<h3 id="req"></h3></h3>

<div style="text-align: center">
    <div id="divcreateHoldingRegister">
        <ul th:each="holdingRegister:${holdingRegisters}">
            <li>
                <h4 th:href="'/registers/'+ ${holdingRegister.id}"  th:text="${holdingRegister.name}+'------ id '+${holdingRegister.id} + ', address:' + ${holdingRegister.address}" ></h4>
                <h3 id="register"></h3>
                <a th:href="'/holdingRegister/del/'+ ${holdingRegister.id}+'/'+${device.id}"><button>  Видалити </button></a>
            </li>
        </ul>
        <button onclick=createRegister('createHoldingRegister')>   Додайте адрес Holding регістра
        </button>
    </div>
    <div id="divcreateInputRegister">
        <br>
        <ul th:each="inputRegister:${inputRegisters}">
            <li >
                <a th:href="'/registers/'+ ${inputRegister.id}" th:text="${inputRegister.address} + ':' + ${inputRegister.value}" ></a>

            </li>
        </ul>
        <button onclick=createRegister('createInputRegister')>    Додайте адрес Input регістра
        </button>
    </div>
    <div id="divcreateDiscreteRegister">
        <br>
        <ul th:each="discreteRegister:${discreteRegisters}">
            <li >
                <a th:href="'/registers/'+ ${discreteRegister.id}" th:text="${discreteRegister.address} + ':' + ${discreteRegister.value}" ></a>
            </li>
        </ul>
        <button onclick=createRegister('createDiscreteRegister')>    Додайте адрес Discrete регістра
        </button>
    </div>
    <div id="divcreateCoilsRegister">
        <br>
        <ul th:each="coilsRegister:${coilsRegisters}">
            <li >
                <a th:href="'/registers/'+ ${coilsRegister.id}" th:text="${coilsRegister.address} + ':' + ${coilsRegister.value}" ></a>
            </li>
        </ul>
        <button onclick=createRegister('createCoilsRegister')>Додайте адрес Coil регістра</button>
    </div>





    <ul th:each="device:${devices}">
        <li >
            <a th:href="'/device/'+ ${device.id}" th:text="${device.name} + ':' + ${device.ipAddress}" ></a>
        </li>
    </ul>


</div>


<script th:inline="javascript">



    function edit(idOfButton) {

        if(document.getElementById("rename")==null
            && document.getElementById("ip")==null
            && document.getElementById("port")==null) {
            var input = document.createElement("input");
            input.setAttribute("type", "text");
            input.setAttribute("id", idOfButton);
            input.setAttribute("placeholder", idOfButton);
            var inputSubmit = document.createElement("input");
            inputSubmit.setAttribute("type", "submit");
            inputSubmit.setAttribute("id", idOfButton+"btn");
            document.getElementById("editDevice").appendChild(input);
            document.getElementById("editDevice").appendChild(inputSubmit);
        }else if(document.getElementById("rename")!=null){
            document.getElementById("rename").remove();
            document.getElementById("renamebtn").remove();
            edit(idOfButton);
        }else if(document.getElementById("ip")!=null){
            document.getElementById("ip").remove();
            document.getElementById("ipbtn").remove();
            edit(idOfButton);

        }else if(document.getElementById("port")!=null){
            document.getElementById("port").remove();
            document.getElementById("portbtn").remove();
            edit(idOfButton);
        }
        let $idOfButton = $('#'+idOfButton+'btn');
        $idOfButton.click(function () {
            let id = [[${device.id}]];
            let deviceData;
            if(idOfButton =="rename") {
                let $name = $('#' + idOfButton);
                let name = $name.val();
                $name.val('');

                deviceData = JSON.stringify({id, name})
                $.ajax({
                    url: 'http://localhost:8080/setName',
                    type: 'POST',
                    data: deviceData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }})
            }
            else if(idOfButton =="ip") {
                let $name = $('#' + idOfButton);
                let ipAddress = $name.val();
                $name.val('');

                deviceData = JSON.stringify({id, ipAddress})
                $.ajax({
                    url: 'http://localhost:8080/setIpAddress',
                    type: 'POST',
                    data: deviceData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }





                })

            }
            else if(idOfButton =="port") {
                let $name = $('#' + idOfButton);
                let port = $name.val();
                $name.val('');

                deviceData = JSON.stringify({id, port})
                $.ajax({
                    url: 'http://localhost:8080/setPort',
                    type: 'POST',
                    data: deviceData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }





                })

            }
        })

    }
    function createRegister(idOfButton) {

        if(document.getElementById("createHoldingRegister")==null
            && document.getElementById("createInputRegister")==null
            && document.getElementById("createDiscreteRegister")==null
            && document.getElementById("createCoilsRegister")==null) {
            var input = document.createElement("input");
            input.setAttribute("type", "text");
            input.setAttribute("id", idOfButton);
            input.setAttribute("placeholder", "address");
            var inputName = document.createElement("input");
            inputName.setAttribute("type", "text");
            inputName.setAttribute("id", idOfButton+"Name");
            inputName.setAttribute("placeholder", "name of address");
            var inputSubmit = document.createElement("input");
            inputSubmit.setAttribute("type", "submit");
            inputSubmit.setAttribute("id", idOfButton+"btn");
            document.getElementById('div'+idOfButton).appendChild(input);
            document.getElementById('div'+idOfButton).appendChild(inputName);

            document.getElementById('div'+idOfButton).appendChild(inputSubmit);
        }else if(document.getElementById("createHoldingRegister")!=null){
            document.getElementById("createHoldingRegister").remove();
            document.getElementById("createHoldingRegisterbtn").remove();
            createRegister(idOfButton);
        }else if(document.getElementById("createInputRegister")!=null){
            document.getElementById("createInputRegister").remove();
            document.getElementById("createInputRegisterbtn").remove();
            createRegister(idOfButton);

        }else if(document.getElementById("createDiscreteRegister")!=null){
            document.getElementById("createDiscreteRegister").remove();
            document.getElementById("createDiscreteRegisterbtn").remove();
            createRegister(idOfButton);
        }else if(document.getElementById("createCoilsRegister")!=null){
            document.getElementById("createCoilsRegister").remove();
            document.getElementById("createCoilsRegisterbtn").remove();
            createRegister(idOfButton);
        }
        let $idOfButton = $('#'+idOfButton+'btn');
        $idOfButton.click(function () {
            let id = [[${device.id}]];
            let addressData;
            if(idOfButton =="createHoldingRegister") {
                let $address = $('#' + idOfButton);
                let address = $address.val();
                $address.val('');
                let $name = $('#' + idOfButton+"Name");
                let name = $name.val();
                $name.val('');

                addressData = JSON.stringify({address, name})
                $.ajax({
                    url: 'http://localhost:8080/device/createHR/'+id,
                    type: 'POST',
                    data: addressData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }
                })
            }
            else if(idOfButton =="createInputRegister") {
                let $name = $('#' + idOfButton);
                let ipAddress = $name.val();
                $name.val('');

                addressData = JSON.stringify({id, ipAddress})
                $.ajax({
                    url: 'http://localhost:8080/createIR',
                    type: 'POST',
                    data: addressData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }





                })

            }
            else if(idOfButton =="createDiscreteRegister") {
                let $name = $('#' + idOfButton);
                let ipAddress = $name.val();
                $name.val('');

                addressData = JSON.stringify({id, ipAddress})
                $.ajax({
                    url: 'http://localhost:8080/createDR',
                    type: 'POST',
                    data: addressData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }





                })

            }
            else if(idOfButton =="createCoilsRegister") {
                let $name = $('#' + idOfButton);
                let port = $name.val();
                $name.val('');

                addressData= JSON.stringify({id, port});
                $.ajax({
                    url: 'http://localhost:8080/createCR',
                    type: 'POST',
                    data: addressData,
                    contentType: 'application/json',
                    success: function () {
                        document.location.reload(true);
                    }





                })

            }
        })

    }


    setInterval(function req() {


            $.ajax({
                type: "GET",
                url: "http://localhost:8080/request",
                success: function (data) {
                    document.getElementById('req').innerText = data;
                }
            })
        }, 3000);
    setInterval(function reg20() {


        $.ajax({
            type: "GET",
            url: "http://localhost:8080/register/38",
            success: function (data) {
                document.getElementById('register').innerText = data;
            }
        })
    }, 1000);

</script>


</body>
</html>